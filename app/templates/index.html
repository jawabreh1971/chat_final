
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© pai6 Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠØ© â€“ FULL v4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #111827;
      background: radial-gradient(circle at top left,#22c55e33,transparent 55%),
                  radial-gradient(circle at top right,#3b82f633,transparent 55%),
                  #020617;
      display: flex;
      flex-wrap: wrap;
      gap: .75rem;
      justify-content: space-between;
      align-items: center;
    }
    header .title { display:flex; flex-direction:column; gap:.1rem; }
    header h1 { margin:0; font-size:1.1rem; letter-spacing:.05em; }
    header span { font-size:.8rem; color:#9ca3af; }
    .api-config {
      display:flex; flex-wrap:wrap; gap:.4rem; align-items:center; justify-content:flex-end;
    }
    .api-config input {
      min-width:260px; padding:.4rem .6rem; border-radius:999px;
      border:1px solid #1f2937; background:#020617; color:#e5e7eb; font-size:.8rem; outline:none;
    }
    .api-config button {
      padding:.4rem .85rem; border-radius:999px; border:none;
      background:linear-gradient(135deg,#22c55e,#3b82f6); color:white;
      cursor:pointer; font-size:.8rem; font-weight:600; box-shadow:0 0 10px #22c55e55;
    }
    .api-config button:disabled { opacity:.6; box-shadow:none; cursor:default; }
    .api-status { font-size:.7rem; color:#9ca3af; margin-top:.1rem; }
    main { flex:1; padding:.75rem; display:flex; justify-content:center; align-items:stretch; }
    .shell {
      width:100%; max-width:1180px;
      background:radial-gradient(circle at top,#0b1120,#020617);
      border-radius:1.25rem; border:1px solid #111827;
      display:flex; flex-direction:column; overflow:hidden;
      box-shadow:0 26px 80px rgba(0,0,0,.65); min-height:72vh;
    }
    .shell-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:.5rem 1rem; border-bottom:1px solid #020617;
      background:linear-gradient(to right,#020617,#020617,#030712);
    }
    .dots{display:flex; gap:.3rem;}
    .dot{width:10px; height:10px; border-radius:999px;}
    .dot.red{background:#f97373;} .dot.yellow{background:#facc15;} .dot.green{background:#22c55e;}
    .shell-title{font-size:.8rem; color:#9ca3af;}
    .shell-badge{
      font-size:.7rem; padding:.15rem .6rem; border-radius:999px;
      border:1px solid #1f2937; color:#9ca3af;
    }
    .body{display:flex; flex:1; min-height:0;}
    nav{
      width:230px; border-inline-end:1px solid #020617;
      background:linear-gradient(to bottom,#020617,#020617,#030712);
      padding:.75rem .6rem .75rem .85rem;
      display:flex; flex-direction:column; gap:.45rem;
    }
    nav h2{margin:0 0 .45rem; font-size:.8rem; color:#6b7280; padding-inline:.25rem;}
    .nav-btn{
      border-radius:.7rem; border:1px solid transparent;
      padding:.45rem .55rem; font-size:.78rem;
      display:flex; align-items:center; gap:.4rem;
      background:transparent; color:#9ca3af; cursor:pointer; text-align:right;
    }
    .nav-btn span.icon{font-size:.9rem;}
    .nav-btn small{display:block; font-size:.65rem; color:#6b7280;}
    .nav-btn.active{
      background:radial-gradient(circle at right,#22c55e33,transparent 60%);
      border-color:#16a34a66; color:#e5e7eb;
    }
    .nav-footer{margin-top:auto; font-size:.7rem; color:#4b5563; padding:.4rem .25rem 0 .25rem;}
    .content{
      flex:1; padding:.75rem .75rem .75rem .65rem;
      display:flex; flex-direction:column; gap:.7rem; min-width:0;
    }
    .panel-title{
      display:flex; justify-content:space-between; gap:.4rem;
      align-items:center; font-size:.8rem; color:#9ca3af; flex-wrap:wrap;
    }
    .panel-title h3{margin:0; font-size:.9rem; color:#e5e7eb;}
    .badge-soft{
      font-size:.7rem; padding:.1rem .6rem; border-radius:999px;
      border:1px solid #1f2937; color:#9ca3af;
    }
    .card{
      border-radius:.95rem; border:1px solid #020617;
      background:radial-gradient(circle at top left,#020617,#020617,#020617);
      padding:.6rem .7rem; display:flex; flex-direction:column; gap:.45rem; min-height:0;
    }
    .row{display:flex; flex-wrap:wrap; gap:.6rem;}
    .row>*{flex:1; min-width:0;}
    label{font-size:.75rem; color:#9ca3af; margin-bottom:.2rem; display:block;}
    .input,textarea{
      width:100%; border-radius:.65rem; border:1px solid #1f2937;
      background:#020617; color:#e5e7eb; padding:.45rem .6rem;
      font-size:.8rem; outline:none; resize:vertical; min-height:60px;
    }
    textarea.small{min-height:40px;}
    .input:focus,textarea:focus{border-color:#22c55e; box-shadow:0 0 0 1px #22c55e33;}
    .btn{
      border-radius:999px; border:none; padding:.45rem .9rem;
      font-size:.8rem; cursor:pointer; font-weight:600;
      display:inline-flex; align-items:center; gap:.3rem;
      background:linear-gradient(135deg,#22c55e,#3b82f6); color:white; box-shadow:0 0 12px #22c55e55;
    }
    .btn.secondary{
      background:#020617; color:#9ca3af; border:1px solid #1f2937; box-shadow:none;
    }
    .btn:disabled{opacity:.6; box-shadow:none; cursor:default;}
    .flex-between{display:flex; justify-content:space-between; align-items:center; gap:.5rem; flex-wrap:wrap;}
    .pill-input{
      display:inline-flex; align-items:center; gap:.3rem;
      background:#020617; border-radius:999px; border:1px solid #1f2937;
      padding-inline:.6rem; font-size:.75rem;
    }
    .pill-input span{color:#6b7280;}
    .pill-input input{
      border:none; background:transparent; color:#e5e7eb;
      padding:.2rem 0; font-size:.75rem; outline:none; min-width:80px;
    }
    .chat-window{
      border-radius:.8rem; border:1px solid #020617;
      background:radial-gradient(circle at top,#020617,#020617,#020617);
      padding:.5rem; max-height:260px; overflow-y:auto; font-size:.78rem;
    }
    .msg{margin-bottom:.4rem; line-height:1.55;}
    .msg .from{font-size:.7rem; color:#6b7280;}
    .bubble{
      display:inline-block; margin-top:.1rem; padding:.35rem .5rem;
      border-radius:.7rem; white-space:pre-wrap;
    }
    .msg.user .bubble{background:linear-gradient(135deg,#1e293b,#020617); float:left;}
    .msg.ai .bubble{background:linear-gradient(135deg,#0f172a,#020617); border-inline-start:2px solid #22c55e; float:right;}
    .msg::after{content:"";display:block;clear:both;}
    .mem-list{max-height:220px; overflow-y:auto; font-size:.78rem;}
    .mem-item{
      padding:.35rem .4rem; border-radius:.65rem; border:1px solid #020617;
      background:#020617; margin-bottom:.3rem;
    }
    .mem-item strong{font-size:.78rem; color:#e5e7eb;}
    .mem-item small{font-size:.65rem; color:#6b7280;}
    .mem-value{
      margin-top:.2rem; font-family:ui-monospace,Menlo,Consolas,"Courier New",monospace;
      font-size:.72rem; direction:ltr; text-align:left; white-space:pre-wrap;
      background:#020617; padding:.25rem .35rem; border-radius:.45rem; border:1px solid #111827;
    }
    .builder-row{display:flex; flex-wrap:wrap; gap:.5rem; align-items:flex-end;}
    .builder-row>*{flex:1; min-width:140px;}
    .log{
      font-size:.7rem; color:#9ca3af; max-height:120px; overflow-y:auto;
      border-radius:.6rem; border:1px dashed #1f2937;
      padding:.35rem .45rem; background:#020617;
    }
    .tag{display:inline-flex; align-items:center; gap:.25rem; border-radius:999px;
      border:1px solid #1f2937; padding:.1rem .45rem; font-size:.7rem; color:#6b7280;}
    .tag-dot{width:6px; height:6px; border-radius:999px; background:#22c55e;}
    .camera-preview{
      width:100%; border-radius:.8rem; border:1px solid #020617;
      background:#000; max-height:240px; object-fit:cover;
    }
    .file-zone{
      border-radius:.8rem; border:1px dashed #374151;
      padding:.5rem; background:#020617; font-size:.78rem;
    }
    .file-zone input[type=file]{margin-top:.3rem; font-size:.75rem;}
    .hint{font-size:.7rem; color:#6b7280;}
    footer{padding:.5rem 1rem .7rem; text-align:center; font-size:.7rem; color:#4b5563;}
    @media (max-width:900px){
      .body{flex-direction:column-reverse;}
      nav{width:100%; flex-direction:row; overflow-x:auto; border-inline-end:none;}
      nav h2{display:none;}
      .nav-btn{flex:1; min-width:140px; justify-content:center;}
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <h1>Ù„ÙˆØ­Ø© pai6 Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠØ© â€“ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ FULL v4</h1>
      <span>ÙŠØ§ÙØ§ ØªØªØ­ÙƒÙ… Ù…Ù† Ù‡Ù†Ø§ (LOW / NON CODE) ÙˆØ§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ ÙŠÙ†ÙÙ‘Ø° (Ø­Ø§ÙˆÙŠØ§ØªØŒ Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù…Ù„ÙØ§Øª Ø¶Ø®Ù…Ø©ØŒ Ø£Ø¬Ù‡Ø²Ø©).</span>
    </div>
    <div class="api-config">
      <div>
        <input id="apiBaseInput" type="text" placeholder="API URL Ù…Ø«Ø§Ù„: https://pai6-backend.onrender.com" />
        <div class="api-status" id="apiStatus"></div>
      </div>
      <div>
        <input id="adminKeyInput" type="password" placeholder="Admin Key (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø£Ø¯Ù…Ù†)" />
      </div>
      <button id="saveApiBtn">Ø­ÙØ¸</button>
    </div>
  </header>

  <main>
    <div class="shell">
      <div class="shell-header">
        <div class="dots">
          <div class="dot red"></div>
          <div class="dot yellow"></div>
          <div class="dot green"></div>
        </div>
        <div class="shell-title">pai6 :: sovereign-dashboard</div>
        <div class="shell-badge">LOW / NON CODE â€¢ LAW MANUAL â€¢ READY FOR HEAVY FILES</div>
      </div>
      <div class="body">
        <nav>
          <h2>Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h2>
          <button class="nav-btn active" data-panel="chat">
            <span class="icon">ğŸ’¬</span>
            <div>Ø´Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„<small>Ù†Øµ + ØµÙˆØª</small></div>
          </button>
          <button class="nav-btn" data-panel="memory">
            <span class="icon">ğŸ§ </span>
            <div>Ø§Ù„Ø°Ø§ÙƒØ±Ø©<small>ØªÙØ¶ÙŠÙ„Ø§Øª & Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</small></div>
          </button>
          <button class="nav-btn" data-panel="builder">
            <span class="icon">ğŸ› ï¸</span>
            <div>Ù…ØµÙ†Ø¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹<small>Ø­Ø²Ù… / Ø³ÙƒØ±Ø¨ØªØ§Øª / Ø®Ø¯Ù…Ø§Øª</small></div>
          </button>
          <button class="nav-btn" data-panel="files">
            <span class="icon">ğŸ“‚</span>
            <div>Ù…Ù„ÙØ§Øª & ÙƒØ§Ù…ÙŠØ±Ø§<small>Excel / CAD / Media / OCR</small></div>
          </button>
          <div class="nav-footer">
            Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø§ ØªÙ†ÙØ° Ø£ÙŠ ÙƒÙˆØ¯ Ø¨Ù†ÙØ³Ù‡Ø§Ø› ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ (Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡/Ø§Ù„Ø¨Ø§ÙƒØ³ØªØ§Ù†ÙŠ) Ø¹Ø¨Ø± API ÙˆØ§Ø­Ø¯.
          </div>
        </nav>

        <section class="content">
          <!-- CHAT -->
          <div class="panel" id="panel-chat">
            <div class="panel-title">
              <h3>Ø´Ø§Ø´Ø© Ø§Ù„Ø´Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© (Ù†Øµ + ØµÙˆØª)</h3>
              <div class="badge-soft">ÙŠØªÙƒÙ„Ù… Ù…Ø¹ /api/chat Ùˆ /api/voice/stt</div>
            </div>
            <div class="card">
              <div class="row">
                <div>
                  <label>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</label>
                  <div class="chat-window" id="chatWindow"></div>
                </div>
                <div style="max-width:280px;">
                  <label>Ø£Ù…Ø± / Ø³Ø¤Ø§Ù„</label>
                  <textarea id="chatInput" class="small" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø£Ù…Ø± Ø£Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..."></textarea>
                  <div class="flex-between" style="margin-top:.35rem;">
                    <div class="pill-input">
                      <span>Fingerprint</span>
                      <input id="fingerprintInput" type="text" value="nasser_profile_v1" />
                    </div>
                    <button class="btn" id="sendChatBtn"><span>Ø¥Ø±Ø³Ø§Ù„</span><span>â£</span></button>
                  </div>
                  <div class="flex-between" style="margin-top:.45rem;">
                    <button class="btn secondary" id="micBtn">ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª</button>
                    <span id="micStatus" class="hint">Ø§Ù„ØµÙˆØª ÙŠØ±Ø³Ù„ ÙƒÙ…Ù„Ù Ø¥Ù„Ù‰ /api/voice/stt (Ù…Ø­Ø±Ùƒ STT Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯).</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- MEMORY -->
          <div class="panel" id="panel-memory" style="display:none;">
            <div class="panel-title">
              <h3>Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h3>
              <div class="badge-soft">ÙˆØ§Ø¬Ù‡Ø© Ù„Ù€ /api/memory/save & /api/memory/list</div>
            </div>
            <div class="row">
              <div class="card">
                <div class="flex-between">
                  <label>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ØµØ± Ø°Ø§ÙƒØ±Ø©</label>
                  <span class="tag"><span class="tag-dot"></span> Ù…Ø±Ø¨ÙˆØ·Ø© Ø¨Ù€ fingerprint ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø´Ø§Øª</span>
                </div>
                <div class="builder-row">
                  <div>
                    <label>Ø§Ù„Ù…ÙØªØ§Ø­ (Key)</label>
                    <input id="memKeyInput" class="input" placeholder="Ù…Ø«Ø§Ù„: preference_language" />
                  </div>
                  <div>
                    <label>Ø§Ù„Ù‚ÙŠÙ…Ø© (JSON Ø£Ùˆ Ù†Øµ)</label>
                    <textarea id="memValueInput" class="small" placeholder='Ù…Ø«Ø§Ù„: {"lang":"ar","dialect":"jo-pal"}'></textarea>
                  </div>
                  <div style="flex:0 0 auto;">
                    <button class="btn" id="saveMemBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</button>
                  </div>
                </div>
                <div class="hint" style="margin-top:.3rem;">
                  Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªØ°Ù‡Ø¨ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¥Ù„Ù‰ `/api/memory/save`Ø› Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø°Ø§ÙƒØ±Ø© ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ù„Ø§Ø­Ù‚Ù‹Ø§ (DB / Ù…Ù„ÙØ§Øª / Redis).
                </div>
              </div>
              <div class="card" style="max-width:320px;">
                <div class="flex-between">
                  <label>Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</label>
                  <button class="btn secondary" id="refreshMemBtn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                </div>
                <div id="memList" class="mem-list"></div>
              </div>
            </div>
          </div>

          <!-- BUILDER -->
          <div class="panel" id="panel-builder" style="display:none;">
            <div class="panel-title">
              <h3>Ù…ØµÙ†Ø¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ / Ø§Ù„Ø­Ø²Ù… (Builder)</h3>
              <div class="badge-soft">ÙŠØªØ­Ø¯Ø« Ù…Ø¹ /api/builder/create & /download</div>
            </div>
            <div class="card">
              <div class="builder-row">
                <div>
                  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                  <input id="projNameInput" class="input" placeholder="Ù…Ø«Ø§Ù„: auto_container_engine" />
                </div>
                <div>
                  <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                  <input id="projTypeInput" class="input" value="python_script" />
                </div>
              </div>
              <div style="margin-top:.4rem;">
                <label>Ø§Ù„ÙˆØµÙ / Spec</label>
                <textarea id="projSpecInput" placeholder="ØµÙ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø³ÙƒØ±Ø¨ØªØŒ Ø®Ø¯Ù…Ø© APIØŒ Ø­Ø§ÙˆÙŠØ©ØŒ Ù…ÙˆØµÙ„ PrimaveraØŒ Ù…Ø­Ù„Ù„ ExcelØŒ Ù…ÙˆØµÙ„ AutoCAD..."></textarea>
              </div>
              <div class="flex-between" style="margin-top:.45rem;">
                <button class="btn" id="buildProjBtn">âš™ï¸ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                <a id="downloadLink" href="#" style="display:none;" class="btn secondary">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø­Ø²Ù…Ø©</a>
              </div>
              <div style="margin-top:.4rem;">
                <label>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</label>
                <div class="log" id="builderLog"></div>
              </div>
            </div>
          </div>

          <!-- FILES & CAMERA -->
          <div class="panel" id="panel-files" style="display:none;">
            <div class="panel-title">
              <h3>Ù…Ù„ÙØ§Øª Ø«Ù‚ÙŠÙ„Ø© & ÙƒØ§Ù…ÙŠØ±Ø§ (Ø£Ù…Ø§Ù…ÙŠØ©/Ø®Ù„ÙÙŠØ©)</h3>
              <div class="badge-soft">ÙˆØ§Ø¬Ù‡Ø© Ù„Ù€ /api/vision/ocr Ùˆ /api/files/upload</div>
            </div>
            <div class="row">
              <div class="card">
                <label>Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (ØµÙˆØ± / OCR / ÙØ­Øµ Ø£Ø¬Ù‡Ø²Ø©)</label>
                <video id="cameraPreview" class="camera-preview" playsinline></video>
                <div class="flex-between" style="margin-top:.4rem;">
                  <div class="flex-between" style="gap:.3rem;">
                    <button class="btn secondary" id="frontCamBtn">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ù…Ø§Ù…ÙŠØ©</button>
                    <button class="btn secondary" id="backCamBtn">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠØ©</button>
                  </div>
                  <button class="btn" id="captureBtn">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ÙˆØ¥Ø±Ø³Ø§Ù„</button>
                </div>
                <div class="hint">
                  Ø§Ù„ØµÙˆØ±Ø© ØªÙØ±Ø³Ù„ Ø¥Ù„Ù‰ `/api/vision/ocr` ÙƒÙ…Ù„ÙØ› Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ ÙŠÙ…ÙƒÙ†Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹:
                  - ØªØ´ØºÙŠÙ„ OCR
                  - ØªØ­Ù„ÙŠÙ„ Ø£Ø¬Ù‡Ø²Ø©
                  - Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ AutoCAD Ø£Ùˆ Ø¬Ø¯Ø§ÙˆÙ„ ÙØ­Øµ.
                </div>
              </div>
              <div class="card">
                <label>Ø±ÙØ¹ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù„ÙØ§Øª Ù‡Ù†Ø¯Ø³ÙŠØ© / ØªØ´ØºÙŠÙ„ÙŠØ©</label>
                <div class="file-zone">
                  <div>Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª (Excel / CAD / Primavera / PDF / Media / ZIP ...):</div>
                  <input id="engFilesInput" type="file" multiple
                    accept=".xls,.xlsx,.csv,.xer,.xml,.dwg,.dxf,.ifc,.rvt,.edb,.mdb,.pdf,.jpg,.jpeg,.png,.mp4,.mov,.zip" />
                  <div class="hint" style="margin-top:.25rem;">
                    ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ø¨Ø± `/api/files/upload` Ù…Ø¹ fingerprint Ùˆ categoryØŒ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ (ETL, CAD parsers, Primavera, ...).
                  </div>
                  <div style="margin-top:.4rem;">
                    <button class="btn" id="uploadEngBtn">â¬†ï¸ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</button>
                  </div>
                  <div class="log" id="filesLog" style="margin-top:.4rem; max-height:100px;"></div>
                </div>
              </div>
            </div>
          </div>

        </section>
      </div>
    </div>
  </main>

  <footer>
    Ø¥ØµØ¯Ø§Ø± FULL v4 â€“ ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Netlify / Ø£ÙŠ Ø§Ø³ØªØ¶Ø§ÙØ© staticØŒ Ø«Ù… Ø±Ø¨Ø·Ù‡ Ø¨Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ pai6-backend-v2 Ø¹Ù„Ù‰ Render Ø£Ùˆ Ø£ÙŠ Ø³ÙŠØ±ÙØ±.
  </footer>

  <script>
    const state = {
      apiBase: "",
      adminKey: "",
      currentPanel: "chat",
      mediaStream: null,
      isRecording: false,
      recorder: null,
      audioChunks: []
    };

    const apiInput = document.getElementById("apiBaseInput");
    const apiStatus = document.getElementById("apiStatus");
    const adminKeyInput = document.getElementById("adminKeyInput");
    const saveApiBtn = document.getElementById("saveApiBtn");

    (function initApi() {
      const savedBase = window.localStorage.getItem("pai6_api_base");
      const savedAdmin = window.localStorage.getItem("pai6_admin_key");
      if (savedBase) {
        state.apiBase = savedBase;
        apiInput.value = savedBase;
        apiStatus.textContent = "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ API Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.";
      } else {
        apiStatus.textContent = "Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ (Render / Google) Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸.";
      }
      if (savedAdmin) {
        state.adminKey = savedAdmin;
        adminKeyInput.value = savedAdmin;
      }
    })();

    saveApiBtn.addEventListener("click", () => {
      const val = apiInput.value.trim();
      if (!val) {
        apiStatus.textContent = "Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­ Ø£ÙˆÙ„Ø§Ù‹.";
        return;
      }
      state.apiBase = val.replace(/\/$/, "");
      window.localStorage.setItem("pai6_api_base", state.apiBase);
      apiStatus.textContent = "ØªÙ… Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ API. ÙƒÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø³ØªØ³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·.";
    });

    function getApiUrl(path) {
      if (!state.apiBase) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø¶Ø¨Ø· Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ API Ø¨Ø¹Ø¯.");
      }
      return state.apiBase + path;
    }

    function withAdmin(headers = {}) {
      if (state.adminKey) {
        headers["X-Admin-Token"] = state.adminKey;
      }
      return headers;
    }

    // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    const navButtons = document.querySelectorAll(".nav-btn");
    const panels = {
      chat: document.getElementById("panel-chat"),
      memory: document.getElementById("panel-memory"),
      builder: document.getElementById("panel-builder"),
      files: document.getElementById("panel-files"),
    };
    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const panel = btn.getAttribute("data-panel");
        if (!panel) return;
        state.currentPanel = panel;
        navButtons.forEach(b => b.classList.toggle("active", b === btn));
        Object.keys(panels).forEach(k => {
          panels[k].style.display = (k === panel) ? "block" : "none";
        });
      });
    });

    // CHAT
    const chatWindow = document.getElementById("chatWindow");
    const chatInput = document.getElementById("chatInput");
    const sendChatBtn = document.getElementById("sendChatBtn");
    const fingerprintInput = document.getElementById("fingerprintInput");
    const micBtn = document.getElementById("micBtn");
    const micStatus = document.getElementById("micStatus");

    function appendMessage(role, text) {
      const div = document.createElement("div");
      div.className = "msg " + (role === "user" ? "user" : "ai");
      const from = document.createElement("div");
      from.className = "from";
      from.textContent = role === "user" ? "Ø£Ù†Øª" : "pai6-backend";
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;
      div.appendChild(from);
      div.appendChild(bubble);
      chatWindow.appendChild(div);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    sendChatBtn.addEventListener("click", async () => {
      const msg = chatInput.value.trim();
      if (!msg) return;
      const fp = fingerprintInput.value.trim() || "nasser_profile_v1";
      appendMessage("user", msg);
      chatInput.value = "";
      sendChatBtn.disabled = true;
      try {
        const url = getApiUrl("/api/chat");
        const res = await fetch(url, {
          method: "POST",
          headers: withAdmin({ "Content-Type": "application/json" }),
          body: JSON.stringify({ message: msg, fingerprint: fp })
        });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        appendMessage("ai", data.reply || "[Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯]");
      } catch (err) {
        appendMessage("ai", "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API: " + err.message);
      } finally {
        sendChatBtn.disabled = false;
      }
    });

    // VOICE (ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ /api/voice/stt)
    async function startRecording() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        micStatus.textContent = "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø§ÙŠÙƒ Ø£Ùˆ Ø£Ù†Ù‡ Ù…Ø­Ø¸ÙˆØ±.";
        return;
      }
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        state.mediaStream = stream;
        state.audioChunks = [];
        const recorder = new MediaRecorder(stream);
        state.recorder = recorder;
        recorder.ondataavailable = e => {
          if (e.data.size > 0) state.audioChunks.push(e.data);
        };
        recorder.onstop = async () => {
          if (state.mediaStream) {
            state.mediaStream.getTracks().forEach(t => t.stop());
          }
          const blob = new Blob(state.audioChunks, { type: "audio/webm" });
          micStatus.textContent = "Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ /api/voice/stt (Ø¥Ù† ÙˆÙØ¬Ø¯ ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯)...";
          try {
            const url = getApiUrl("/api/voice/stt");
            const fp = fingerprintInput.value.trim() || "nasser_profile_v1";
            const form = new FormData();
            form.append("file", blob, "voice.webm");
            form.append("fingerprint", fp);
            const res = await fetch(url, { method: "POST", headers: withAdmin(), body: form });
            if (!res.ok) throw new Error("HTTP " + res.status);
            const data = await res.json();
            const text = data.text || JSON.stringify(data);
            appendMessage("ai", "Ø±Ø¯ STT: " + text);
            micStatus.textContent = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª ÙˆØ§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø¯ Ù…Ù† Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ (placeholder).";
          } catch (err) {
            micStatus.textContent = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŒ Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ /api/voice/stt: " + err.message;
          }
        };
        recorder.start();
        state.isRecording = true;
        micBtn.textContent = "â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
        micStatus.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... Ø§Ø¶ØºØ· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø¥ÙŠÙ‚Ø§Ù.";
      } catch (err) {
        micStatus.textContent = "ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + err.message;
      }
    }

    function stopRecording() {
      if (state.recorder && state.recorder.state !== "inactive") {
        state.recorder.stop();
      }
      state.isRecording = false;
      micBtn.textContent = "ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª";
    }

    micBtn.addEventListener("click", () => {
      if (!state.isRecording) startRecording(); else stopRecording();
    });

    // MEMORY
    const memKeyInput = document.getElementById("memKeyInput");
    const memValueInput = document.getElementById("memValueInput");
    const saveMemBtn = document.getElementById("saveMemBtn");
    const refreshMemBtn = document.getElementById("refreshMemBtn");
    const memList = document.getElementById("memList");

    saveMemBtn.addEventListener("click", async () => {
      const key = memKeyInput.value.trim();
      let valueRaw = memValueInput.value.trim();
      const fp = fingerprintInput.value.trim() || "nasser_profile_v1";
      if (!key) { alert("Ø£Ø¯Ø®Ù„ key Ø£ÙˆÙ„Ø§Ù‹."); return; }
      let value;
      if (!valueRaw) value = "";
      else {
        try { value = JSON.parse(valueRaw); }
        catch { value = valueRaw; }
      }
      saveMemBtn.disabled = true;
      try {
        const url = getApiUrl("/api/memory/save");
        const res = await fetch(url, {
          method: "POST",
          headers: withAdmin({ "Content-Type": "application/json" }),
          body: JSON.stringify({ fingerprint: fp, key, value })
        });
        if (!res.ok) throw new Error("HTTP " + res.status);
        await res.json();
        memKeyInput.value = ""; memValueInput.value = "";
        loadMemories();
      } catch (err) {
        alert("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø°Ø§ÙƒØ±Ø©: " + err.message);
      } finally {
        saveMemBtn.disabled = false;
      }
    });

    async function loadMemories() {
      const fp = fingerprintInput.value.trim() || "nasser_profile_v1";
      memList.innerHTML = "<div class='hint'>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª...</div>";
      try {
        const url = getApiUrl("/api/memory/list?fingerprint=" + encodeURIComponent(fp));
        const res = await fetch(url, { headers: withAdmin() });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        memList.innerHTML = "";
        (data.items || []).forEach(item => {
          const el = document.createElement("div");
          el.className = "mem-item";
          const title = document.createElement("div");
          const strong = document.createElement("strong");
          strong.textContent = item.key;
          const small = document.createElement("small");
          small.textContent = " â€¢ #" + item.id;
          title.appendChild(strong); title.appendChild(small);
          const val = document.createElement("div");
          val.className = "mem-value";
          try { val.textContent = JSON.stringify(item.value, null, 2); }
          catch { val.textContent = String(item.value); }
          el.appendChild(title); el.appendChild(val);
          memList.appendChild(el);
        });
        if (!memList.innerHTML) {
          memList.innerHTML = "<div class='hint'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¨ØµÙ…Ø©.</div>";
        }
      } catch (err) {
        memList.innerHTML = "<div style='color:#f97373;font-size:.75rem;'>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª: " + err.message + "</div>";
      }
    }

    refreshMemBtn.addEventListener("click", loadMemories);

    // BUILDER
    const projNameInput = document.getElementById("projNameInput");
    const projTypeInput = document.getElementById("projTypeInput");
    const projSpecInput = document.getElementById("projSpecInput");
    const buildProjBtn = document.getElementById("buildProjBtn");
    const builderLog = document.getElementById("builderLog");
    const downloadLink = document.getElementById("downloadLink");

    function logBuilder(msg) {
      const time = new Date().toLocaleTimeString();
      const line = document.createElement("div");
      line.textContent = "[" + time + "] " + msg;
      builderLog.appendChild(line);
      builderLog.scrollTop = builderLog.scrollHeight;
    }

    buildProjBtn.addEventListener("click", async () => {
      const name = projNameInput.value.trim();
      const type = projTypeInput.value.trim() || "python_script";
      const spec = projSpecInput.value.trim();
      const fp = fingerprintInput.value.trim() || "nasser_profile_v1";
      if (!name) { alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹."); return; }
      buildProjBtn.disabled = true;
      logBuilder("Ø¨Ø¯Ø¡ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: " + name + " ...");
      try {
        const url = getApiUrl("/api/builder/create");
        const res = await fetch(url, {
          method: "POST",
          headers: withAdmin({ "Content-Type": "application/json" }),
          body: JSON.stringify({
            fingerprint: fp,
            project_name: name,
            project_type: type,
            spec: spec || "Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† ÙˆØµÙ Ù…ÙØµÙ„ (Ù…Ù† Ù„ÙˆØ­Ø© pai6)."
          })
        });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        const rel = data.download_url || ("/api/builder/download/" + encodeURIComponent(name) + ".zip");
        const full = getApiUrl(rel.replace(/^https?:\/\/[^/]+/, ""));
        downloadLink.href = full;
        downloadLink.style.display = "inline-flex";
        logBuilder("ØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø©. Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„.");
      } catch (err) {
        logBuilder("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ù†Ø§Ø¡: " + err.message);
      } finally {
        buildProjBtn.disabled = false;
      }
    });

    // FILES & CAMERA
    const cameraPreview = document.getElementById("cameraPreview");
    const frontCamBtn = document.getElementById("frontCamBtn");
    const backCamBtn = document.getElementById("backCamBtn");
    const captureBtn = document.getElementById("captureBtn");
    const engFilesInput = document.getElementById("engFilesInput");
    const uploadEngBtn = document.getElementById("uploadEngBtn");
    const filesLog = document.getElementById("filesLog");

    async function startCamera(useBack) {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        filesLog.textContent = "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø£Ù†Ù‡Ø§ Ù…Ø­Ø¸ÙˆØ±Ø©.";
        return;
      }
      try {
        if (state.mediaStream) {
          state.mediaStream.getTracks().forEach(t => t.stop());
        }
        const constraints = { video: { facingMode: useBack ? "environment" : "user" }, audio: false };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        state.mediaStream = stream;
        cameraPreview.srcObject = stream;
        cameraPreview.play();
        filesLog.textContent = "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¹Ù…Ù„ (" + (useBack ? "Ø®Ù„ÙÙŠØ©" : "Ø£Ù…Ø§Ù…ÙŠØ©") + ").";
      } catch (err) {
        filesLog.textContent = "ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + err.message;
      }
    }

    frontCamBtn.addEventListener("click", () => startCamera(false));
    backCamBtn.addEventListener("click", () => startCamera(true));

    captureBtn.addEventListener("click", async () => {
      if (!state.mediaStream || !cameraPreview.videoWidth) {
        filesLog.textContent = "Ø´ØºÙ‘Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø©.";
        return;
      }
      const canvas = document.createElement("canvas");
      canvas.width = cameraPreview.videoWidth;
      canvas.height = cameraPreview.videoHeight;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(cameraPreview, 0, 0);
      canvas.toBlob(async (blob) => {
        if (!blob) return;
        filesLog.textContent = "ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©. Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ /api/vision/ocr ...";
        try {
          const url = getApiUrl("/api/vision/ocr");
          const form = new FormData();
          form.append("image", blob, "capture.png");
          const res = await fetch(url, { method: "POST", headers: withAdmin(), body: form });
          if (!res.ok) throw new Error("HTTP " + res.status);
          const data = await res.json();
          const text = data.text || JSON.stringify(data);
          filesLog.textContent = "Ø±Ø¯ /api/vision/ocr: " + text.substring(0, 200);
        } catch (err) {
          filesLog.textContent = "Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© (Ø±Ø¨Ù…Ø§ Ø§Ù„Ù…Ø³Ø§Ø± ØºÙŠØ± Ø¬Ø§Ù‡Ø² ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯): " + err.message;
        }
      }, "image/png");
    });

    function logFiles(msg) {
      const time = new Date().toLocaleTimeString();
      const line = document.createElement("div");
      line.textContent = "[" + time + "] " + msg;
      filesLog.appendChild(line);
      filesLog.scrollTop = filesLog.scrollHeight;
    }

    uploadEngBtn.addEventListener("click", async () => {
      const files = engFilesInput.files;
      if (!files || files.length === 0) { alert("Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª Ø£ÙˆÙ„Ø§Ù‹."); return; }
      const fp = fingerprintInput.value.trim() || "nasser_profile_v1";
      const form = new FormData();
      for (let i = 0; i < files.length; i++) form.append("files", files[i]);
      form.append("fingerprint", fp);
      form.append("category", "engineering_bundle");
      uploadEngBtn.disabled = true;
      logFiles("Ø¨Ø¯Ø¡ Ø±ÙØ¹ " + files.length + " Ù…Ù„Ù/Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ /api/files/upload ...");
      try {
        const url = getApiUrl("/api/files/upload");
        const res = await fetch(url, { method: "POST", headers: withAdmin(), body: form });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        logFiles("ØªÙ… Ø§Ù„Ø±ÙØ¹. Ø±Ø¯ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯: " + JSON.stringify(data).substring(0, 200));
      } catch (err) {
        logFiles("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹ Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§Ø± ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ Ø¨Ø¹Ø¯: " + err.message);
      } finally {
        uploadEngBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
